## The Case for Learned Index Structures
|Author|Ins|Email|
|:------------- |:---------------:| -------------:|
| Tim Kraska| MIT| kraska@mit.edu|
| Alex Beutel| Google| alexbeutel@google.com|
| Ed H.Chi| Google| edchi@google.com|
| Jeffery Dean| Google | jeff@google.com|
| neoklis Polyzotis | Google| npolyzotis@google.com|


### Abstract

索引即模型：一个B树索引可以视作一个将key映射到一个有序数据中某个记录的模型，一个哈希索引是将key映射到无序数组中某个记录的模型，BitMap索引是表示数据是否存在的模型。在这个探索性的研究论文中，我们给予一个假设和判断：所有现存的索引结构都可以用其他类型的模型取代，包括深度学习模型，这些替代模型我们称之为学习索引（Learned Indexes）。主要的观点是一个模型可以通过学习排序顺序或者查找主键的结构来提高找到记录位置的小路。我们从理论上分析了在哪些条件下，学习索引的性能会超过传统索引结构并且描述了设置学习索引的主要挑战。使用多组真实世界的数据集进行内存写入对比后，我们初步的结论表明，使用神经网络，可以比缓存优化过的B树快70%。更重要的是，我们相信用学习模型取代数据管理系统的核心组件在未来的系统设计中有巨大的意义，这个工作只是未来可能的一瞥。

### Introduction

为了高效访问数据，人们设计了很多不同的索引结构来满足不同的访问范式。比如，B树是对于范围查询的最好选择，比如取到一个特定时间片的所有数据；哈希表对基于Key的查询很有效；以及布隆过滤器可以用来检查记录是否存在。因为索引对于数据库系统或其他应用的重要性，在过去几十年在内存、缓存或CPU效率上调整了很多（？）
然而，所有的现存的通用目的的数据结构都假设数据的最坏分布，而不是利用真实世界最有可能的存在模式。比如，现在的目标是构建一个高性能系统来存储和查询一个固定长度的记录，记录内是连续的整型key(比如，1~100M)，正常人不会在这种应该用偏差位置（offset）的场景用B树来构建索引，因为会把查询复杂度从O(1)变成O(logn)。内存方面，不使用B树，索引内存大小也会从O(n)缩减到O(1)。总而言之，了解数据的真实分布可以帮助所有数据库系统的索引性能更好。
当然，在很多现实世界的使用例子里，数据并不完美遵循某个已知的范式，而为每个场景都设计一种特定的方案工程量又太高了。然而我们认为机器学习可以做到使学习一种反应数据范式与关系的模型，然后使用自动调整索引结构成为现实，我们称之为学习索引，从而大大降低工程量。
在此论文中，我们探索了包括神经网络在内的学习模型，可以用来取代传统的数据结构，比如B树、布隆过滤器。这听上去很反直觉，因为机器学习无法提供传统数据结构的那种直观的数据语义，并且通常认为神经网络模型的估值开销很大（ps我是这样理解这句话的反正）。然而我们认为，这些看上去明显的障碍都不是问题，我们的观点是使用学习模型有巨大的潜力，尤其基于下一代硬件（ps好了，我知道是卖TPU的了）。
在语义保证方面，例如神经网络的模型在很大程度上是可以替代索引的。比如，B树可以视作一个预测数据位置的模型。布隆过滤器是一个二元分类器，来表示数据是否存在。显然，他们存在微妙但是重要的区别。比如，布隆过滤器会有假存在，但是不会出现假不存在（ps详见布隆过滤器特征吧）。（下面是不重要的话）
（论证了一段本文测试的硬件前提是存在的，不是基于一种科幻的硬件条件，所以有应用价值）
（声明一下本文的目的不是在全面替代传统索引结构，而是为机器学习的应用场景提供一个新的思路）

### 2 Range Index
如前所述，索引结构就是模型。(举了一个B树搜索的例子)。
出于优化考虑，索引不会存储每个key，只会存储某页的某些key，比如一页数据的第一个key。从而大幅减索引的key数量，也不会造成任何的性能下降。因此B树是一种在ML中称为回归树的模型: 模型给出一个位置与正负值，并且保证数据如果存在那就在这个范围之内。因此我们可以用机器学习模型，包括深度学习模型来替代索引，只要输出能保证类似这个位置与正负值。
B树必须要预先排序的数据才能有用，查询新数据时需要重新平衡，在机器学习中，这叫重新学习。那么我们定义min-error, max-error就是这个模型在训练数据上的最大误差，在以后的结果中保证这个最大误差永远是正确的。那么之后，给到一个key，模型预测这个key的位置，数据一定在预测位置的最大误差范围内。因为用任何回归模型都可以替代B树，无论是线性回归还是神经网络。
现在，用学习索引替代B树还有其他技术挑战，比如B树在充分利用缓存时，插入与查询的开销是优先的。另外，B树可以将key映射到非连续的磁盘或内存。更进一步，如果查询的key不存在，某些特定模型可能会返回超出最大误差的数据，比如非单调递增模型（ps这里没看懂）这些问题下面的部分会阐明。
又举了一个连续整型key的例子，说明线性模型可以理解这种数据，而B树总是O(logN)。接下来要探讨模型复杂度和准确度的平衡

#### 2.1  What Model Complexity Can We Afford? A Back-Of-The-Envelope Calculation

能承受什么样的模型复杂度？来毛估估一下。